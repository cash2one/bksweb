/*---------------------------------------------------------------------------------------------

@author       Constantin Saguin - @brutaldesign
@link            http://csag.co
@github        http://github.com/brutaldesign/swipebox
@version     1.2.1
@license      MIT License

----------------------------------------------------------------------------------------------*/
!function(e,i,$,t){$.swipebox=function(s,o){var n={useCSS:!0,initialIndexOnArray:0,hideBarsDelay:3e3,videoMaxWidth:1140,vimeoColor:"CCCCCC",beforeOpen:null,afterClose:null},a=this,r=[],s=s,d=s.selector,l=$(d),c=i.createTouch!==t||"ontouchstart"in e||"onmsgesturechange"in e||navigator.msMaxTouchPoints,p=!!e.SVGSVGElement,u=e.innerWidth?e.innerWidth:$(e).width(),b=e.innerHeight?e.innerHeight:$(e).height(),h='<div id="swipebox-overlay">				<div id="swipebox-slider"></div>				<div id="swipebox-caption"></div>				<div id="swipebox-action">					<a id="swipebox-close"></a>					<a id="swipebox-prev"></a>					<a id="swipebox-next"></a>				</div>		</div>';a.settings={},a.init=function(){a.settings=$.extend({},n,o),$.isArray(s)?(r=s,x.target=$(e),x.init(a.settings.initialIndexOnArray)):l.click(function(e){r=[];var i,t,s;s||(t="rel",s=$(this).attr(t)),s&&""!==s&&"nofollow"!==s?$elem=l.filter("["+t+'="'+s+'"]'):$elem=$(d),$elem.each(function(){var e=null,i=null;$(this).attr("title")&&(e=$(this).attr("title")),$(this).attr("href")&&(i=$(this).attr("href")),r.push({href:i,title:e})}),i=$elem.index($(this)),e.preventDefault(),x.target=$(e.target),x.init(i)})},a.refresh=function(){$.isArray(s)||(x.destroy(),$elem=$(d),x.actions())};var x={init:function(e){a.settings.beforeOpen&&a.settings.beforeOpen(),this.target.trigger("swipebox-start"),$.swipebox.isOpen=!0,this.build(),this.openSlide(e),this.openMedia(e),this.preloadMedia(e+1),this.preloadMedia(e-1)},build:function(){var e=this;if($("body").append(h),e.doCssTrans()&&($("#swipebox-slider").css({"-webkit-transition":"left 0.4s ease","-moz-transition":"left 0.4s ease","-o-transition":"left 0.4s ease","-khtml-transition":"left 0.4s ease",transition:"left 0.4s ease"}),$("#swipebox-overlay").css({}),$("#swipebox-action, #swipebox-caption").css({"-webkit-transition":"0.5s","-moz-transition":"0.5s","-o-transition":"0.5s","-khtml-transition":"0.5s",transition:"0.5s"})),p){var i=$("#swipebox-action #swipebox-close").css("background-image");i=i.replace("png","svg"),$("#swipebox-action #swipebox-prev,#swipebox-action #swipebox-next,#swipebox-action #swipebox-close").css({"background-image":i})}$.each(r,function(){$("#swipebox-slider").append('<div class="slide"></div>')}),e.setDim(),e.actions(),e.keyboard(),e.gesture(),e.animBars(),e.resize()},setDim:function(){var i,t,s={};"onorientationchange"in e?e.addEventListener("orientationchange",function(){0==e.orientation?(i=u,t=b):(90==e.orientation||-90==e.orientation)&&(i=b,t=u)},!1):(i=e.innerWidth?e.innerWidth:$(e).width(),t=e.innerHeight?e.innerHeight:$(e).height()),s={width:i,height:t},$("#swipebox-overlay").css(s)},resize:function(){var i=this;$(e).resize(function(){i.setDim()}).resize()},supportTransition:function(){for(var e="transition WebkitTransition MozTransition OTransition msTransition KhtmlTransition".split(" "),s=0;s<e.length;s++)if(i.createElement("div").style[e[s]]!==t)return e[s];return!1},doCssTrans:function(){return a.settings.useCSS&&this.supportTransition()?!0:void 0},gesture:function(){if(c){var e=this,i=null,t=10,s={},o={},n=$("#swipebox-caption, #swipebox-action");n.addClass("visible-bars"),e.setTimeout(),$("body").bind("touchstart",function(e){return $(this).addClass("touching"),o=e.originalEvent.targetTouches[0],s.pageX=e.originalEvent.targetTouches[0].pageX,$(".touching").bind("touchmove",function(e){e.preventDefault(),e.stopPropagation(),o=e.originalEvent.targetTouches[0]}),!1}).bind("touchend",function(a){a.preventDefault(),a.stopPropagation(),i=o.pageX-s.pageX,i>=t?e.getPrev():-t>=i?e.getNext():n.hasClass("visible-bars")?(e.clearTimeout(),e.hideBars()):(e.showBars(),e.setTimeout()),$(".touching").off("touchmove").removeClass("touching")})}},setTimeout:function(){if(a.settings.hideBarsDelay>0){var i=this;i.clearTimeout(),i.timeout=e.setTimeout(function(){i.hideBars()},a.settings.hideBarsDelay)}},clearTimeout:function(){e.clearTimeout(this.timeout),this.timeout=null},showBars:function(){var e=$("#swipebox-caption, #swipebox-action");this.doCssTrans()?e.addClass("visible-bars"):($("#swipebox-caption").animate({top:0},500),$("#swipebox-action").animate({bottom:0},500),setTimeout(function(){e.addClass("visible-bars")},1e3))},hideBars:function(){var e=$("#swipebox-caption, #swipebox-action");this.doCssTrans()?e.removeClass("visible-bars"):($("#swipebox-caption").animate({top:"-50px"},500),$("#swipebox-action").animate({bottom:"-50px"},500),setTimeout(function(){e.removeClass("visible-bars")},1e3))},animBars:function(){var e=this,i=$("#swipebox-caption, #swipebox-action");i.addClass("visible-bars"),e.setTimeout(),$("#swipebox-slider").click(function(t){i.hasClass("visible-bars")||(e.showBars(),e.setTimeout())}),$("#swipebox-action").hover(function(){e.showBars(),i.addClass("force-visible-bars"),e.clearTimeout()},function(){i.removeClass("force-visible-bars"),e.setTimeout()})},keyboard:function(){var i=this;$(e).bind("keyup",function(e){e.preventDefault(),e.stopPropagation(),37==e.keyCode?i.getPrev():39==e.keyCode?i.getNext():27==e.keyCode&&i.closeSlide()})},actions:function(){var e=this;r.length<2?$("#swipebox-prev, #swipebox-next").hide():($("#swipebox-prev").bind("click touchend",function(i){i.preventDefault(),i.stopPropagation(),e.getPrev(),e.setTimeout()}),$("#swipebox-next").bind("click touchend",function(i){i.preventDefault(),i.stopPropagation(),e.getNext(),e.setTimeout()})),$("#swipebox-close").bind("click touchend",function(i){e.closeSlide()})},setSlide:function(e,i){i=i||!1;var t=$("#swipebox-slider");this.doCssTrans()?t.css({left:100*-e+"%"}):t.animate({left:100*-e+"%"}),$("#swipebox-slider .slide").removeClass("current"),$("#swipebox-slider .slide").eq(e).addClass("current"),this.setTitle(e),i&&t.fadeIn(),$("#swipebox-prev, #swipebox-next").removeClass("disabled"),0==e?$("#swipebox-prev").addClass("disabled"):e==r.length-1&&$("#swipebox-next").addClass("disabled")},openSlide:function(e){$("html").addClass("swipebox"),this.setSlide(e,!0)},preloadMedia:function(e){var i=this,s=null;r[e]!==t&&(s=r[e].href),i.isVideo(s)?i.openMedia(e):setTimeout(function(){i.openMedia(e)},1e3)},openMedia:function(e){var i=this,s=null;return r[e]!==t&&(s=r[e].href),0>e||e>=r.length?!1:void(i.isVideo(s)?$("#swipebox-slider .slide").eq(e).html(i.getVideo(s)):i.loadMedia(s,function(){$("#swipebox-slider .slide").eq(e).html(this)}))},setTitle:function(e,i){var s=null;$("#swipebox-caption").empty(),r[e]!==t&&(s=r[e].title),s&&$("#swipebox-caption").append(s)},isVideo:function(e){return e&&(e.match(/youtube\.com\/watch\?v=([a-zA-Z0-9\-_]+)/)||e.match(/vimeo\.com\/([0-9]*)/))?!0:void 0},getVideo:function(e){var i="",t="",s=e.match(/watch\?v=([a-zA-Z0-9\-_]+)/),o=e.match(/vimeo\.com\/([0-9]*)/);return s?i='<iframe width="560" height="315" src="//www.youtube.com/embed/'+s[1]+'" frameborder="0" allowfullscreen></iframe>':o&&(i='<iframe width="560" height="315"  src="http://player.vimeo.com/video/'+o[1]+"?byline=0&amp;portrait=0&amp;color="+a.settings.vimeoColor+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'),'<div class="swipebox-video-container" style="max-width:'+a.settings.videomaxWidth+'px"><div class="swipebox-video">'+i+"</div></div>"},loadMedia:function(e,i){if(!this.isVideo(e)){var t=$("<img>").on("load",function(){i.call(t)});t.attr("src",e)}},getNext:function(){var e=this;index=$("#swipebox-slider .slide").index($("#swipebox-slider .slide.current")),index+1<r.length?(index++,e.setSlide(index),e.preloadMedia(index+1)):($("#swipebox-slider").addClass("rightSpring"),setTimeout(function(){$("#swipebox-slider").removeClass("rightSpring")},500))},getPrev:function(){index=$("#swipebox-slider .slide").index($("#swipebox-slider .slide.current")),index>0?(index--,this.setSlide(index),this.preloadMedia(index-1)):($("#swipebox-slider").addClass("leftSpring"),setTimeout(function(){$("#swipebox-slider").removeClass("leftSpring")},500))},closeSlide:function(){$("html").removeClass("swipebox"),$(e).trigger("resize"),this.destroy()},destroy:function(){$(e).unbind("keyup"),$("body").unbind("touchstart"),$("body").unbind("touchmove"),$("body").unbind("touchend"),$("#swipebox-slider").unbind(),$("#swipebox-overlay").remove(),$.isArray(s)||s.removeData("_swipebox"),this.target&&this.target.trigger("swipebox-destroy"),$.swipebox.isOpen=!1,a.settings.afterClose&&a.settings.afterClose()}};a.init()},$.fn.swipebox=function(e){if(!$.data(this,"_swipebox")){var i=new $.swipebox(this,e);this.data("_swipebox",i)}return this.data("_swipebox")}}(window,document,jQuery);