!function($,e){function s(){this._state=[],this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}var t="selectbox",a=!1,i=!0;$.extend(s.prototype,{_isOpenSelectbox:function(e){if(!e)return a;var s=this._getInst(e);return s.isOpen},_isDisabledSelectbox:function(e){if(!e)return a;var s=this._getInst(e);return s.isDisabled},_attachSelectbox:function(e,s){function n(){var e,s,t=this.attr("id").split("_")[1];for(e in c._state)e!==t&&c._state.hasOwnProperty(e)&&(s=$("select[sb='"+e+"']")[0],s&&c._closeSelectbox(s))}function l(){var s=arguments[1]&&arguments[1].sub?!0:!1,t=arguments[1]&&arguments[1].disabled?!0:!1;arguments[0].each(function(a){var n=$(this),l=$("<li>"),o;n.is(":selected")&&(u.text(n.text()),g=i),a===_-1&&l.addClass("last"),n.is(":disabled")||t?(o=$("<span>",{text:n.text()}).addClass(d.settings.classDisabled),s&&o.addClass(d.settings.classSub),o.appendTo(l)):(o=$("<a>",{href:"#"+n.val(),rel:n.val()}).text(n.text()).bind("click.sb",function(s){s&&s.preventDefault&&s.preventDefault();var t=p,a=$(this),i=t.attr("id").split("_")[1];c._changeSelectbox(e,a.attr("rel"),a.text()),c._closeSelectbox(e)}).bind("mouseover.sb",function(){var e=$(this);e.parent().siblings().find("a").removeClass(d.settings.classFocus),e.addClass(d.settings.classFocus)}).bind("mouseout.sb",function(){$(this).removeClass(d.settings.classFocus)}),s&&o.addClass(d.settings.classSub),n.is(":selected")&&o.addClass(d.settings.classFocus),o.appendTo(l)),l.appendTo(b)})}if(this._getInst(e))return a;var o=$(e),c=this,d=c._newInst(o),r,u,p,b,g=a,f=o.find("optgroup"),h=o.find("option"),_=h.length;o.attr("sb",d.uid),$.extend(d.settings,c._defaults,s),c._state[d.uid]=a,o.hide(),r=$("<div>",{id:"sbHolder_"+d.uid,"class":d.settings.classHolder,tabindex:o.attr("tabindex")}),u=$("<a>",{id:"sbSelector_"+d.uid,href:"#","class":d.settings.classSelector,click:function(s){s.preventDefault(),n.apply($(this),[]);var t=$(this).attr("id").split("_")[1];c._state[t]?c._closeSelectbox(e):c._openSelectbox(e)}}),p=$("<a>",{id:"sbToggle_"+d.uid,href:"#","class":d.settings.classToggle,click:function(s){s.preventDefault(),n.apply($(this),[]);var t=$(this).attr("id").split("_")[1];c._state[t]?c._closeSelectbox(e):c._openSelectbox(e)}}),p.appendTo(r),b=$("<ul>",{id:"sbOptions_"+d.uid,"class":d.settings.classOptions,css:{display:"none"}}),o.children().each(function(e){var s=$(this),t,a={};s.is("option")?l(s):s.is("optgroup")&&(t=$("<li>"),$("<span>",{text:s.attr("label")}).addClass(d.settings.classGroup).appendTo(t),t.appendTo(b),s.is(":disabled")&&(a.disabled=!0),a.sub=!0,l(s.find("option"),a))}),g||u.text(h.first().text()),$.data(e,t,d),r.data("uid",d.uid).bind("keydown.sb",function(e){var s=e.charCode?e.charCode:e.keyCode?e.keyCode:0,a=$(this),i=a.data("uid"),n=a.siblings("select[sb='"+i+"']").data(t),l=a.siblings(["select[sb='",i,"']"].join("")).get(0),o=a.find("ul").find("a."+n.settings.classFocus);switch(s){case 37:case 38:if(o.length>0){var d;$("a",a).removeClass(n.settings.classFocus),d=o.parent().prevAll("li:has(a)").eq(0).find("a"),d.length>0&&(d.addClass(n.settings.classFocus).focus(),$("#sbSelector_"+i).text(d.text()))}break;case 39:case 40:var d;$("a",a).removeClass(n.settings.classFocus),d=o.length>0?o.parent().nextAll("li:has(a)").eq(0).find("a"):a.find("ul").find("a").eq(0),d.length>0&&(d.addClass(n.settings.classFocus).focus(),$("#sbSelector_"+i).text(d.text()));break;case 13:o.length>0&&c._changeSelectbox(l,o.attr("rel"),o.text()),c._closeSelectbox(l);break;case 9:if(l){var n=c._getInst(l);n&&(o.length>0&&c._changeSelectbox(l,o.attr("rel"),o.text()),c._closeSelectbox(l))}var r=parseInt(a.attr("tabindex"),10);e.shiftKey?r--:r++,$("*[tabindex='"+r+"']").focus();break;case 27:c._closeSelectbox(l)}return e.stopPropagation(),!1}).delegate("a","mouseover",function(e){$(this).addClass(d.settings.classFocus)}).delegate("a","mouseout",function(e){$(this).removeClass(d.settings.classFocus)}),u.appendTo(r),b.appendTo(r),r.insertAfter(o),$("html").live("mousedown",function(e){e.stopPropagation(),$("select").selectbox("close")}),$([".",d.settings.classHolder,", .",d.settings.classSelector].join("")).mousedown(function(e){e.stopPropagation()})},_detachSelectbox:function(e){var s=this._getInst(e);return s?($("#sbHolder_"+s.uid).remove(),$.data(e,t,null),void $(e).show()):a},_changeSelectbox:function(e,s,t){var a,n=this._getInst(e);n&&(a=this._get(n,"onChange"),$("#sbSelector_"+n.uid).text(t)),s=s.replace(/\'/g,"\\'"),$(e).find("option[value='"+s+"']").attr("selected",i),n&&a?a.apply(n.input?n.input[0]:null,[s,n]):n&&n.input&&n.input.trigger("change")},_enableSelectbox:function(e){var s=this._getInst(e);return s&&s.isDisabled?($("#sbHolder_"+s.uid).removeClass(s.settings.classHolderDisabled),s.isDisabled=a,void $.data(e,t,s)):a},_disableSelectbox:function(e){var s=this._getInst(e);return!s||s.isDisabled?a:($("#sbHolder_"+s.uid).addClass(s.settings.classHolderDisabled),s.isDisabled=i,void $.data(e,t,s))},_optionSelectbox:function(e,s,i){var n=this._getInst(e);return n?(n[s]=i,void $.data(e,t,n)):a},_openSelectbox:function(e){var s=this._getInst(e);if(s&&!s.isOpen&&!s.isDisabled){var a=$("#sbOptions_"+s.uid),n=parseInt($(window).height(),10),l=$("#sbHolder_"+s.uid).offset(),o=$(window).scrollTop(),c=a.prev().height(),d=n-(l.top-o)-c/2,r=this._get(s,"onOpen");a.css({top:c+"px",maxHeight:d-c+"px"}),"fade"===s.settings.effect?a.fadeIn(s.settings.speed):a.slideDown(s.settings.speed),$("#sbToggle_"+s.uid).addClass(s.settings.classToggleOpen),this._state[s.uid]=i,s.isOpen=i,r&&r.apply(s.input?s.input[0]:null,[s]),$.data(e,t,s)}},_closeSelectbox:function(e){var s=this._getInst(e);if(s&&s.isOpen){var i=this._get(s,"onClose");"fade"===s.settings.effect?$("#sbOptions_"+s.uid).fadeOut(s.settings.speed):$("#sbOptions_"+s.uid).slideUp(s.settings.speed),$("#sbToggle_"+s.uid).removeClass(s.settings.classToggleOpen),this._state[s.uid]=a,s.isOpen=a,i&&i.apply(s.input?s.input[0]:null,[s]),$.data(e,t,s)}},_newInst:function(e){var s=e[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:s,input:e,uid:Math.floor(99999999*Math.random()),isOpen:a,isDisabled:a,settings:{}}},_getInst:function(e){try{return $.data(e,t)}catch(s){throw"Missing instance data for this selectbox"}},_get:function(s,t){return s.settings[t]!==e?s.settings[t]:this._defaults[t]}}),$.fn.selectbox=function(e){var s=Array.prototype.slice.call(arguments,1);return"string"==typeof e&&"isDisabled"==e?$.selectbox["_"+e+"Selectbox"].apply($.selectbox,[this[0]].concat(s)):"option"==e&&2==arguments.length&&"string"==typeof arguments[1]?$.selectbox["_"+e+"Selectbox"].apply($.selectbox,[this[0]].concat(s)):this.each(function(){"string"==typeof e?$.selectbox["_"+e+"Selectbox"].apply($.selectbox,[this].concat(s)):$.selectbox._attachSelectbox(this,e)})},$.selectbox=new s,$.selectbox.version="0.2"}(jQuery);